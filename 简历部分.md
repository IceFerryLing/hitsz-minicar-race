

## 2025.09.25-2025.12.02    STM32智能循迹小车控制系统    三人合作

### 项目描述
基于STM32F103的高性能自动循迹系统，针对复杂赛道（S弯、虚线、直角弯）设计。采用**12路光电阵列+BMI270陀螺仪**的多传感器融合方案，通过**三级串级PID算法**实现高速稳定循迹。

**技术栈：** STM32 HAL库 | C语言 | 串级PID控制 | 传感器数据融合 | 嵌入式系统设计

#### 核心职责：
- **控制算法设计**：设计并实现**位置环(PD) -> 角速度环(PD) -> 速度环(PI)**的三级串级控制架构，有效解决了单环控制在高速过弯时的“甩尾”和震荡问题。
- **传感器数据融合**：
    - 实现**加权平均算法**处理12路光电数据，将离散的传感器信号转化为连续的偏差值。
    - 开发**丢线保护（记忆）策略**与**急弯增强算法**，大幅提升了车辆在虚线和急弯路况下的鲁棒性。
    - 集成BMI270陀螺仪，通过角速度积分实时解算车身姿态，作为中间环反馈。
- **系统架构实现**：基于1ms定时器中断构建硬实时控制系统，保证控制周期抖动 <10us。
- **调试与优化**：开发串口遥测功能，实时监控 `GyroZ`、`Error` 等关键数据，通过波形分析整定6组PID参数。

#### 技术难点与亮点：
- **串级PID架构**：利用陀螺仪的高频响应特性构建角速度内环，使转向响应时间缩短至 **100ms** 以内，转向超调量控制在 **5%** 以下。
- **鲁棒性设计**：在传感器全丢线情况下，系统能自动锁定上一时刻的转向趋势，防止车辆冲出赛道。
- **高精度循迹**：通过加权算法实现亚像素级路径检测，直道稳态误差控制在 **±2mm** 以内。

#### 核心代码逻辑（串级控制）：
```c
// 1ms 定时器中断中执行
void PID_Control_Loop(void) {
    // 1. 数据采集与融合
    float line_dev = Calculate_Weighted_Deviation(); // 光电加权偏差
    float gyro_z   = Get_Gyro_Z();                   // 陀螺仪角速度
    
    // 2. 第一级：位置环 (输出目标角速度)
    // 作用：根据线路偏差，计算车身需要多快的转向速度
    float target_turn_rate = KP_pos * line_dev + KD_pos * (line_dev - last_dev);
    
    // 3. 第二级：角速度环 (输出差速补偿)
    // 作用：让车身实际角速度快速跟随目标，抑制震荡
    float diff_speed = KP_gyro * (target_turn_rate - gyro_z);
    
    // 4. 第三级：速度环 (输出PWM)
    // 作用：分别控制左右电机维持目标转速
    Motor_L_PWM = PID_Speed(Target_Speed - diff_speed, Encoder_L);
    Motor_R_PWM = PID_Speed(Target_Speed + diff_speed, Encoder_R);
}
```

#### 项目成果：
- 成功实现最高 **2m/s** 稳定循迹（根据实际情况修改速度）。
- 掌握了从硬件驱动适配、控制算法建模到实车调试的完整嵌入式开发闭环。
